---
layout: post
title:  "Facebook"
date:   2015-06-12 01:00:00
categories: "facebook"
asset_path: /assets/posts/Facebook/
tags: []
---

# Login

#### 서버쪽에서 사용자 인증방법

일단 클라이언트쪽에서 로그인을 하게 되면 다음과 같은 정보를 얻습니다.

{% highlight json %}
{
  "authResponse": {
    "accessToken": "CAAHII8ZBoBZCIBAO7uSCfOgayUeiz15ohHYoaa4lQTvfgKISpjooPTGCvFH5milEeSaJ6biZBrFStL7NKOZBplSdOu7s50SldrvaZCHIEL4rLZA8wHGDLyddgHL1DuLVtrQERnxk404l8z7hE15Rf0tv7oULo6dJ3tOFtrpTrbj2Gapqzu2uk6EfB3AQQwpF7iJ4ePrtTz5QZDZD",
    "expiresIn": 3866,
    "signedRequest": "yIiAxYGBW37MKoWUodbTHBFiQrCwUNHkQCc0jupuuVI.eyJhbGdvcml0aG0iOiJITUFDLVNIQTI1NiIsImNvZGUiOiJBUUJlV2k3OUNOblhBY29wNE1FTGg2Vm84enZiSHNXR0lMWWtNRml6VFlaM2FxdGd5V3JLOGM4SnhVNDVLUEJaeFc4WVdYdFhBSlVBaC1jZVRhc3E5MEdGcnRIN2xHY1ZHckl6S1pSZ0ZjWUNGUkhuektaazRVUS00ZktSNGs0OC1hWkFsRFNqSXhKbmQ4d3d3WVZNZm5VWjVSNEd1a1hvX1p0bzNibXVNZE8xb0hGaXA5WGNPQW5pUUMtcEFRVDB1NHo2amdrVEJtMnlMOEZVcU5LTWFySjhCVGZ3enNiblZlTGpZcE5ERVc1MXl3RG8tWTd1VFhyOW9CSUVCS2h4U3drMVhHeUtzeEctT3ZUNDZVd2tSYTNLVW91UTRYN3RTc3ZnWWdydGU1Z2c4UlpJa1YybGhDbEtuUnlTUWxwd05OUFk5dXNRWXhXQVhSdE1jdlJsczFDYSIsImlzc3VlZF9hdCI6MTQ1MjUxMzMzMywidXNlcl9pZCI6IjU2MjEyOTk0MDYxMDAyOSJ9",
    "userID": "562129940610029"
  },
  "status": "connected"
}
{% endhighlight %}

중요한점은 signedRequest인데 다음의 코드를 통해서 정보를 꺼내올수 있습니다.<br>
해당 정보는 permission이 없어도 얻을수 있는 정보이며, sercret key를 사용해서 꺼낼수 있습니다.

{% highlight python %}

def parse_signed_request(signed_request, secret):
    [encoded_sig, payload] = signed_request.split('.')

    # decode data
    sig = base64_url_decode(encoded_sig)
    data = json.loads(base64_url_decode(payload))

    if data['algorithm'].upper() != 'HMAC-SHA256':
        raise ValueError('Unknown algorithm. Expected HMAC-SHA256')

    # check sig
    expected_sig = hmac.new(secret, payload, sha256).digest()
    if sig != expected_sig:
        raise StandardError('Bad Signed JSON signature!')

    return data


def base64_url_decode(input):
    input += '=' * (4 - (len(input) % 4))
    return urlsafe_b64decode(input.encode('utf-8'))
{% endhighlight %}


위의 함수를 통해서 얻어진 정보는 다음과 같은 내용을 담고 있습니다.

{% highlight json %}
{
  "issued_at": 1452513333,
  "code": "AQBeWi79CNnXAcop4MELh6Vo8zvbHsWGILYkMFizTYZ3aqtgyWrK8c8JxU45KPBZxW8YWXtXAJUAh-ceTasq90GFrtH7lGcVGrIzKZRgFcYCFRHnzKZk4UQ-4fKR4k48-aZAlDSjIxJnd8wwwYVMfnUZ5R4GukXo_Zto3bmuMdO1oHFip9XcOAniQC-pAQT0u4z6jgkTBm2yL8FUqNKMarJ8BTfwzsbnVeLjYpNDEW51ywDo-Y7uTXr9oBIEBKhxSwk1XGyKsxG-OvT46UwkRa3KUouQ4X7tSsvgYgrte5gg8RZIkV2lhClKnRySQlpwNNPY9usQYxWAXRtMcvRls1Ca",
  "user_id": "562129940610029",
  "algorithm": "HMAC-SHA256"
}
{% endhighlight %}