<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Neural Network for Concrete Strength using R</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="개발자 조창민입니다. Machine Learning, Python, Django, R, Android, AWS, Game Server, Startup 등등 다양한 경험을 갖고 있는 개발자 입니다.">
    <link rel="canonical" href="http://andersonjo.github.io//neural-network/2015/07/26/Neural-Network-for-concrete/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/assets/bootstrap-3.3.5-dist/css/bootstrap.min.css">


</head>


<body>

<header class="site-header">

  <div class="wrap">

    <a class="site-title" href="/">Anderson Jo 헤헤헤</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
          <a class="page-link" href="/about/">About</a>
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


<div class="page-content">
    <div class="wrap">
        <div class="post">

    <header class="post-header">
        <h1>Neural Network for Concrete Strength using R</h1>

        <p class="meta">Jul 26, 2015</p>
    </header>

    <article class="post-content">
        <div>
    <img src="/assets/posts/Neural-Network-for-concrete/concrete.jpg" class="img-responsive img-rounded" />
</div>
<p>신경망이라는 주제는 Machine Learning분야에서 80년대부터 계속해서 발전해온 기술입니다.<br />
맛보기로 R을 사용해서 신경망(Neural Network)을 해보도록 하겠습니다.<br /></p>

<p>콘크리트의 퍼포먼스 즉 강도(Strength)를 결정하는데에는 많은 변수들이 있습니다.<br />
들어가는 재료들의 양에 따라서 콘크리트의 강도가 달라지기 때문에 여기에는 특별한 수학적 공식을 얻어내기가 쉽지가 않습니다. <br /></p>

<p>Neural Network를 이용하면 특별한 수학적 공식 (콘크리트의 강도를 알아내는..) 없이 ANN(Artificial Neural Network)을 트레이닝 시키고
훈련된 ANN으로 다시 새로운 데이터로 예측을 할 것입니다.<br /> </p>

<h3>Data &amp; References</h3>
<p><a href="/assets/posts/Neural-Network-for-concrete/concrete.csv">concrete.csv</a><br />
<a href="/assets/posts/Neural-Network-for-concrete/example.R">example.R</a><br />
<a href="http://www.amazon.com/Machine-Learning-R-Brett-Lantz/dp/1782162143/ref=sr_1_1?ie=UTF8&amp;qid=1437813079&amp;sr=8-1&amp;keywords=machine+learning+with+r">Machine Learning with R</a> </p>

<h3>Neuralnet 설치 </h3>

<p>여러 Neural Network 라이브러리들이 있지만.. Neuralnet이라는 라이브러리를 사용할 것입니다.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">install.packages<span class="p">(</span><span class="s">&quot;neuralnet&quot;</span><span class="p">)</span></code></pre></div>

<h3>일단 코드로 써보자</h3>

<p>read.csv 함수를 통해서 concrete.csv파일을 읽습니다.<br />
stringAsFactors는 R의 데이터타입중에 string을 factor로 읽지 않고  vector로 읽겠다는 뜻이며, F는 FALSE(boolean)값과 같습니다.<br />
끝에 [-1]은 첫번째 row 필드값을 exclude시키겠다는 말..<br /><br /></p>

<p>포인트는.. cement, flag, ash, water, superplastic, coarseagg, findagg, age 등등 다양한 요소가 모여서 궁극적으로 strength를 
결정을 하게 됩니다. 각각의 재료및 요소에 따라서 strength의 값이 달라지는데.. 역시 정확한 공식을 얻기는 쉽지 않겠죠..</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">concrete <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&#39;concrete.csv&#39;</span><span class="p">,</span> stringsAsFactors <span class="o">=</span> <span class="bp">F</span><span class="p">)[</span><span class="m">-1</span><span class="p">]</span>
<span class="kp">head</span><span class="p">(</span>concrete<span class="p">)</span>

  cement  flag ash water superplastic coarseagg findagg age strength
<span class="m">1</span>  <span class="m">540.0</span>   <span class="m">0.0</span>   <span class="m">0</span>   <span class="m">162</span>          <span class="m">2.5</span>    <span class="m">1040.0</span>   <span class="m">676.0</span>  <span class="m">28</span>    <span class="m">79.99</span>
<span class="m">2</span>  <span class="m">540.0</span>   <span class="m">0.0</span>   <span class="m">0</span>   <span class="m">162</span>          <span class="m">2.5</span>    <span class="m">1055.0</span>   <span class="m">676.0</span>  <span class="m">28</span>    <span class="m">61.89</span>
<span class="m">3</span>  <span class="m">332.5</span> <span class="m">142.5</span>   <span class="m">0</span>   <span class="m">228</span>          <span class="m">0.0</span>     <span class="m">932.0</span>   <span class="m">594.0</span> <span class="m">270</span>    <span class="m">40.27</span>
<span class="m">4</span>  <span class="m">332.5</span> <span class="m">142.5</span>   <span class="m">0</span>   <span class="m">228</span>          <span class="m">0.0</span>     <span class="m">932.0</span>   <span class="m">594.0</span> <span class="m">365</span>    <span class="m">41.05</span>
<span class="m">5</span>  <span class="m">198.6</span> <span class="m">132.4</span>   <span class="m">0</span>   <span class="m">192</span>          <span class="m">0.0</span>     <span class="m">978.4</span>   <span class="m">825.5</span> <span class="m">360</span>    <span class="m">44.30</span>
<span class="m">6</span>  <span class="m">266.0</span> <span class="m">114.0</span>   <span class="m">0</span>   <span class="m">228</span>          <span class="m">0.0</span>     <span class="m">932.0</span>   <span class="m">670.0</span>  <span class="m">90</span>    <span class="m">47.03</span></code></pre></div>

<p>데이터를 살펴보니.. 각각의 필드들이 제각각의 범위의 값을 갖고 있습니다. 즉.. Normalize가 필요합니다.<br />
여러방법의 normalize가 있는데 우리는 min max normalize를 사용하겠습니다. </p>

<div class="highlight"><pre><code class="language-r" data-lang="r">normalize <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
  <span class="kr">return</span> <span class="p">((</span>x <span class="o">-</span> <span class="kp">min</span><span class="p">(</span>x<span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="kp">max</span><span class="p">(</span>x<span class="p">)</span> <span class="o">-</span> <span class="kp">min</span><span class="p">(</span>x<span class="p">)))</span>
<span class="p">}</span>
concrete <span class="o">&lt;-</span> <span class="kp">as.data.frame</span><span class="p">(</span><span class="kp">lapply</span><span class="p">(</span>concrete<span class="p">,</span> normalize<span class="p">))</span>
<span class="kp">head</span><span class="p">(</span>concrete<span class="p">)</span>

        cement         flag ash        water  superplastic    coarseagg      findagg           age     strength
<span class="m">1</span> <span class="m">1.0000000000</span> <span class="m">0.0000000000</span>   <span class="m">0</span> <span class="m">0.3210862620</span> <span class="m">0.07763975155</span> <span class="m">0.6947674419</span> <span class="m">0.2057200201</span> <span class="m">0.07417582418</span> <span class="m">0.9674847390</span>
<span class="m">2</span> <span class="m">1.0000000000</span> <span class="m">0.0000000000</span>   <span class="m">0</span> <span class="m">0.3210862620</span> <span class="m">0.07763975155</span> <span class="m">0.7383720930</span> <span class="m">0.2057200201</span> <span class="m">0.07417582418</span> <span class="m">0.7419957643</span>
<span class="m">3</span> <span class="m">0.5262557078</span> <span class="m">0.3964941569</span>   <span class="m">0</span> <span class="m">0.8482428115</span> <span class="m">0.00000000000</span> <span class="m">0.3808139535</span> <span class="m">0.0000000000</span> <span class="m">0.73901098901</span> <span class="m">0.4726547901</span>
<span class="m">4</span> <span class="m">0.5262557078</span> <span class="m">0.3964941569</span>   <span class="m">0</span> <span class="m">0.8482428115</span> <span class="m">0.00000000000</span> <span class="m">0.3808139535</span> <span class="m">0.0000000000</span> <span class="m">1.00000000000</span> <span class="m">0.4823719945</span>
<span class="m">5</span> <span class="m">0.2205479452</span> <span class="m">0.3683917641</span>   <span class="m">0</span> <span class="m">0.5607028754</span> <span class="m">0.00000000000</span> <span class="m">0.5156976744</span> <span class="m">0.5807827396</span> <span class="m">0.98626373626</span> <span class="m">0.5228603463</span>
<span class="m">6</span> <span class="m">0.3744292237</span> <span class="m">0.3171953255</span>   <span class="m">0</span> <span class="m">0.8482428115</span> <span class="m">0.00000000000</span> <span class="m">0.3808139535</span> <span class="m">0.1906673357</span> <span class="m">0.24450549451</span> <span class="m">0.5568705619</span></code></pre></div>

<p>lapply함수에 바로 dataframe type을 넣을수가 있고 lapply는 각각의 필드마다 normalize함수를 진행하게 됩니다.<br />
가장 큰 값은 1이 되었고.. 가장 작은 값은 0으로 normalize를 하였습니다.<br /></p>

<blockquote>
만약 lapply를 사용하지 않고 바로 normalize(concrete) 를 사용하게 되면.. dataframe내에서 가장 큰 값이 1을 갖고, 가장 작은 값이 0을
갖게 됩니다. 즉 cement필드에서 0~1 또는.. water에서 0~1값을 갖는게 아니라.. 전체 dataframe내에서 normalize를 하게 되며.. 
이는 우리가 원하는 결과값이 아닙니다.
</blockquote>

<p>그 다음으로.. concrete 데이터의 75%를 트레이닝용으로 사용하고, 나머지는 해당 neural network가 제대로 돌아가는지 검증용으로 사용을 할 
것입니다. </p>

<div class="highlight"><pre><code class="language-r" data-lang="r">max_index <span class="o">&lt;-</span> <span class="kp">length</span><span class="p">(</span>concrete<span class="o">$</span>strength<span class="p">)</span>
slice_index <span class="o">&lt;-</span> <span class="kp">round</span><span class="p">(</span>max_index <span class="o">*</span> <span class="m">0.75</span><span class="p">)</span>
training_data <span class="o">&lt;-</span> concrete<span class="p">[</span><span class="m">1</span><span class="o">:</span>slice_index<span class="p">,]</span>
test_data <span class="o">&lt;-</span> concrete<span class="p">[</span>slice_index<span class="o">:</span>max_index<span class="p">,]</span></code></pre></div>

<h3>Neural Network 트레이닝 시키기</h3>
<p>자 이제 모든 준비가 끝났으니 Neural Network를 트레이닝 시키겠습니다. <br /></p>

<div class="highlight"><pre><code class="language-r" data-lang="r">concrete_model <span class="o">&lt;-</span>
  neuralnet<span class="p">(</span>strength <span class="o">~</span> cement <span class="o">+</span> flag <span class="o">+</span> ash <span class="o">+</span> water <span class="o">+</span> superplastic <span class="o">+</span> coarseagg <span class="o">+</span>
      findagg <span class="o">+</span> age<span class="p">,</span> data <span class="o">=</span> training_data<span class="p">,</span> hidden <span class="o">=</span> <span class="m">3</span>
  <span class="p">)</span>
plot<span class="p">(</span>concrete_model<span class="p">)</span> <span class="c1"># plot the neural networks</span></code></pre></div>

<p><img src="/assets/posts/Neural-Network-for-concrete/neuralnet_hidden_3.png" class="img-responsive img-rounded" /></p>

<p>위의 그림에 보면 8개의 nodes가 보입니다. 이것을 Input Nodes라고 부릅니다.<br />
중간에 3개의 원이 있는데 이것을 Hidden Nodes라고 부릅니다.<br />
마지막 제일 오른쪽에 1개의 원이있는데 이것을 Output Node라고 부릅니다.<br /></p>

<p>Backpropagation이 있는데.. 트레이닝중에 틀리거나 맞는것이 있을때마다 결과치에 따라서 각각의 Nodes들의 수치를 변경하게 됩니다.<br />
즉 각각의 Nodes들에는 서로 연결되어있어서 강하게 연결되어 있는것이 있고, 약하게 연결된것이 있는데.. 
Backpropagation을 통해서 이 가중치를 변경을 하게 되는 것입니다.<br /></p>

<p>아! 참고로 최초로 Nodes들이 연결이 될때는 어떻게 가중치를 주는가? 인데..
최초에는 랜덤값을 그냥 넣습니다. 따라서 여러분이 집접 저 코드를 돌려보면 매번 다른 값이 나오게 될 것입니다.<br /></p>

<p>자! 그렇다면 이렇게 학습된 Neural Network의 성능시험이 필요하지 않을까요?
처음에 75%데이터를 학습으로 사용했으니, 나머지 데이터를 이용해서 정확하게 예측을 하는지 검사해봅시다.<br /></p>

<h3> Neural Network 성능측정 (Prediction) </h3>

<p>성능측정은 상관관계분석(Correlation)을 통해서 측정을 하게 됩니다.<br />
1값이 나올수록 예측의 정확성이 높다는 뜻이고, 0값이 나온다면 예측값이 떨어진다는 뜻입니다. </p>

<div class="highlight"><pre><code class="language-r" data-lang="r">model_results <span class="o">&lt;-</span> compute<span class="p">(</span>concrete_model<span class="p">,</span> test_data<span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">8</span><span class="p">])</span>
cor<span class="p">(</span>model_results<span class="o">$</span>net.result<span class="p">,</span> test_data<span class="o">$</span>strength<span class="p">)</span>
<span class="m">0.8201494476</span></code></pre></div>


    </article>

</div>
    </div>
</div>

<div class="wrap simple_profile">
    <div class="row">
        <div class="col-md-4">
            <img src="/assets/images/me.jpg">
        </div>
        <div class="col-md-8" style="vertical-align: top;">
            <h2 style="margin-top:0px;">Anderson Jo</h2>
            <span style="color:#990000">
                Machine Learning, Python, R, Game Server,Data Analysis, Android, Full-Stack, AWS
            </span>
            <br>
            경영 마인드를 갖은 진격의 개발자 입니다.<br>
            Email: <i style="color:#0086B3">a141890@gmail.com</i><br>
            Kakao Talk: <i style="color:#0086B3">anderson52</i><br>

        </div>
    </div>

</div>

<footer class="site-footer">
    <div class="wrap">
        <header class="footer-heading">
            <h2 class="footer-heading" style="margin-bottom:0px;">Anderson Jo 헤헤헤</h2>

        </header>


        <div class="footer-col-1 column">
            <ul>
                <li>Anderson Jo 헤헤헤</li>
                <li><a href="mailto:a141890@gmail.com">a141890@gmail.com</a></li>
            </ul>
        </div>

        <div class="footer-col-2 column">
            <ul>
                
                <li>
                    <a href="https://github.com/AndersonJo">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
                        <span class="username">AndersonJo</span>
                    </a>
                </li>
                
                
            </ul>
        </div>

        <div class="footer-col-3 column">
            <p class="text">개발자 조창민입니다. Machine Learning, Python, Django, R, Android, AWS, Game Server, Startup 등등 다양한 경험을 갖고 있는 개발자 입니다.</p>
        </div>

    </div>

</footer>



</body>
</html>